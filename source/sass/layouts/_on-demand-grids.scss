/**
 * @file
 * On-demand grids.
 */


// #############################################################################
// Mixins.

@mixin on-demand-grid-3-col {
  & > .column {
    @include grid-column($grid-column-count/3);

    margin-bottom: 1rem;

    &:nth-child(3n+1) {
      clear: left;
    }
    &:nth-child(3n+3) {
      clear: right;
    }
    &:nth-last-child(2):nth-child(3n+2),
    &:nth-last-child(2):nth-child(3n+1),
    &:nth-last-child(3):nth-child(3n+1)
    {
      margin-bottom: 0;
    }
  }
}

@mixin on-demand-grid-4-col {
  & > .column {
    @include grid-column($grid-column-count/4);

    margin-bottom: 1rem;

    &:nth-child(4n+1) {
      clear: left;
    }
    &:nth-child(4n+4) {
      clear: right;
    }
    &:nth-last-child(2):nth-child(4n+3),
    &:nth-last-child(2):nth-child(4n+2),
    &:nth-last-child(2):nth-child(4n+1),
    &:nth-last-child(3):nth-child(4n+2),
    &:nth-last-child(3):nth-child(4n+1),
    &:nth-last-child(4):nth-child(4n+1)
    {
      margin-bottom: 0;
    }
  }
}


// #############################################################################
// Shared.

.row--wrap {
  & > .column {
    @include vertical-item-margins();
  }
}


// #############################################################################
// 3 column grid.

.row--wrap--3 {
  @include breakpoint(wide) {
    @include on-demand-grid-3-col;
  }
}


// #############################################################################
// 4 column grid.

.row--wrap--4 {
  // Even the 4 col grid uses the 3 col mixin on not-big-enough screens.
  @media (min-width: map-get($breakpoints, wide)) and (max-width: map-get($breakpoints, wide-m-max)) {
    @include on-demand-grid-3-col;
  }
  @include breakpoint(wide-l) {
    @include on-demand-grid-4-col;
  }
}


// #############################################################################
// Flexboxified grids.

// It seems any of the hereby defined on-demand grids can be flexboxified by
// adding the classes row--wrap and row--flexbox--wide to them.

// Note: this will only work if a modernizr build is included and is producing
// an .mdz-flexbox class on the :root element.

// See https://css-tricks.com/snippets/css/a-guide-to-flexbox/ .

.row--flexbox--wide {
  @include breakpoint(wide) {
    .mdz-flexbox & {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;

      &::before,
      &::after {
        display: none;
      }

      & > .column {
        display: flex;
        flex: 0 1 auto;
        float: none;

        & > .box {
          flex: 0 1 auto;
          width: 100%;
        }
      }
    }
  }
}
